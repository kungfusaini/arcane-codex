FROM hugomods/hugo:latest AS builder
WORKDIR /src

# Copy package files first for better layer caching
COPY . .

# Initialize git submodules (themes)
RUN git submodule update --init --recursive

# Run Hugo development server with watch
EXPOSE 1313

CMD ["hugo", "server", "--bind", "0.0.0.0", "--port", "1313", "--baseURL", "http://arcanecodex.localhost/", "--environment", "development", "--watch", "--buildDrafts", "--buildFuture"]