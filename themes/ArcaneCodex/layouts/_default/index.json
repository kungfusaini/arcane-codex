{{- $.Scratch.Add "index" slice -}}
{{- range site.RegularPages -}}
    {{- if and (not .Params.searchHidden) (ne .Layout `archives`) (ne .Layout `search`) }}
    {{- $categories := slice }}
    {{- if .Params.categories }}
        {{- if reflect.IsSlice .Params.categories }}
            {{- range .Params.categories }}
                {{- $categories = $categories | append . }}
            {{- end }}
        {{- else }}
            {{- $categories = $categories | append .Params.categories }}
        {{- end }}
    {{- end }}
    {{- $tags := slice }}
    {{- if .Params.tags }}
        {{- if reflect.IsSlice .Params.tags }}
            {{- range .Params.tags }}
                {{- $tags = $tags | append . }}
            {{- end }}
        {{- else }}
            {{- $tags = $tags | append .Params.tags }}
        {{- end }}
    {{- end }}
    {{- $.Scratch.Add "index" (dict 
        "title" .Title 
        "content" .Plain 
        "permalink" .Permalink 
        "summary" .Summary
        "date" .Date
        "readingTime" .ReadingTime
        "categories" $categories
        "tags" $tags
    ) -}}
    {{- end }}
{{- end -}}
{{- $.Scratch.Get "index" | jsonify -}}
